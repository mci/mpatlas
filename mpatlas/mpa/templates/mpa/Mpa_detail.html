{% extends "base.html" %}

{% block title %}{{ mpa.name }}{% endblock %}

{% block base_head_extra %}
<link rel="stylesheet" href="{{ STATIC_URL }}Leaflet/dist/leaflet.css" />
<!--[if lte IE 8]><link rel="stylesheet" href="{{ STATIC_URL }}Leaflet/dist/leaflet.ie.css" /><![endif]-->

<link href="{{ STATIC_URL }}css/sitedetail.css" media="screen" rel="stylesheet" type="text/css" />

<script type="text/javascript">

    require({
        baseUrl: '{{ STATIC_URL }}js',
        paths: {
            jquery: '//ajax.googleapis.com/ajax/libs/jquery/1.7.0/jquery.min',
            jqueryui: '//ajax.googleapis.com/ajax/libs/jqueryui/1.8.16/jquery-ui.min',
            //leaflet: '//leaflet.cloudmade.com/dist/leaflet',
            leaflet: '{{ STATIC_URL }}Leaflet/dist/leaflet',
            json2: '//ajax.cdnjs.com/ajax/libs/json2/20110223/json2',
            underscore: 'underscore-min',
			backbone: 'backbone-min',
            //underscore: '//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.2.2/underscore-min', // versions pre 1.3.0 have problems when used with backbone via requireJS
            //backbone: '//cdnjs.cloudflare.com/ajax/libs/backbone.js/0.5.3/backbone-min'
        },
        //priority: ['jquery']
		priority: [
			'leaflet'
		]
    }, [
        'prep',
        'sitedetail',
        'jquery',
        'depend!jqueryui[jquery]',
    ], function(Prep, SiteDetail) {
        $(function() {
            Prep.preparePage();
            var site_id = {{ mpa.pk }},
                feature_url = '{% url mpa-geojson mpa.pk %}?simplified=false',
                is_point = {% if mpa.is_point %}true{% else %}false{% endif %},
                point_within = [{{ mpa.point_within.coords.0 }},{{ mpa.point_within.coords.1 }}],
                bbox = [[{{ mpa.bbox_lowerleft.coords.0 }},{{ mpa.bbox_lowerleft.coords.1 }}], [{{ mpa.bbox_upperright.coords.0 }},{{ mpa.bbox_upperright.coords.1 }}]];
            window['sitedetail'] = new SiteDetail.SiteDetail($('#leafletmap'), {{ mpa.pk }}, feature_url, is_point, point_within, bbox);
        });
    });

</script>
{% endblock %}

{% block base_body_content %}
    <div class='modetoggle medium' style="float:right;">
        <a class="modebutton" href="/">Map View</a><a class="modebutton" href="{% url mpa-siteslist %}">List View</a>
    </div>
    <div class="clear" style="clear:both;"></div>
    
    <div id="leftcol" style="float:left; width:34%;">
        <div style="border:1px solid black; border-radius:8px; padding:8px; margin-bottom:8px; background-color:#3C6289; color:white;">
            Protection Level:
            {% if mpa.name == 'Cabo Pulmo' or mpa.protection_level == 'Strongly Protected' %}
                <div style="color:black; padding:2px; border-radius:4px; border: 1px solid silver; background-color: #6F6; width:80%;">Strong</div>
            {% else %}{% if mpa.name == 'Galapagos Marine Reserve' %}
                <div style="color:black; padding:2px; border-radius:4px; border: 1px solid silver; background-color: #F55; width:40%;">Low</div>
            {% else %}
                <!--<div style="color:black; padding:2px; border-radius:4px; border: 1px solid silver; background-color: orange; width:60%;">Moderate</div>-->
                <div style="color:#666; padding:2px; border-radius:4px; border: 1px solid silver; background-color: #ddd; width:80%;">Calculating</div>
            {% endif %}{% endif %}
            <br />
            Conservation Effectiveness:
                <div style="color:#666; padding:2px; border-radius:4px; border: 1px solid silver; background-color: #ddd; width:80%;">Unknown</div>
        </div>
        <div id="siteinfotitle" class="sidebar_item_title">Site Information
            {% if user.is_authenticated %}
	            <a href="edit" style="float:right; color:white; margin-right:8px;">EDIT</a>
	        {% else %}
	            <a class='user_loginlink' href="#login" style="float:right; color:white; margin-right:8px;">EDIT</a>
	        {% endif %}
	    </div>
    	<div id="siteinfo" class="sidebar_item_content siteinfo collapsed">
    		<ul class="infolist" style="list-style:none; margin:0; padding:0;">
            {% for key, value in mpa.display_fields_list %}
                <li style="border-bottom:1px solid #555;"> <strong class="name">{{ value.verbose }}</strong>: <span class="value" style="margin-left:4px;">{{ value.value|truncatewords:20 }}</span></li>
            {% endfor %}
            </ul>
            <a id="infoexpander" class="infoexpander" style="display:block;" href="#" onclick="return false;"><span class="expander"><span style="font-style:normal;">&dArr;</span> See all data records for this site</span><span class="collapser"><span style="font-style:normal;">&uArr;</span> Show less</span></a>
    	</div>
    	<div id='leafletmap'></div>
    </div>
    <div id="rightcol" style="float:right; width: 66%;">
        <div style="padding: 8px;">
            <p class="heading clear" style="margin:0px; padding:0; font-size:32px; line-height:38px; margin-bottom:0px; color:#de744a;">
                {{ mpa.name }}
                <span style="font-size:20px;">{% if mpa.designation_eng %}{{ mpa.designation_eng }} {% endif %}{% if mpa.designation_eng != mpa.designation %}({{ mpa.designation }}){% endif %}</span>
            </p>
            <h4 style="color:#666; margin-bottom:8px; padding-top:0; margin-top:0;">{{ mpa.country }}{% if mpa.sub_location %}: <span style="font-size:.9em;">{{ mpa.sub_location }}</span>{% endif %}</h4>
            
            <div class="sidebar_item_title">Site Description</div>
        	<div class="sidebar_item_content">
        	    {% if mpa.name == 'Cabo Pulmo' %}
                <p>
                    Cabo Pulmo National Marine Park, encompassing approximately 20.7 nautical miles, is a marine protected area located about 40 miles north of San Jose del Cabo on the eastern cape of Baja.  This National Marine Park was established in 1995 by the Mexican government to safeguard the largest coral community in the Gulf of California.  The seven fingers of coral off Cabo Pulmo comprise the most northerly living reef in the eastern Pacific and is home to the only living hard coral reef in the Gulf of California. The 25,000-year-old reef is comprised of 25 different species of coral and 226 species of fish frequent its waters.
                </p>
                <p>
                    Additional species found in the Marine Park include humpback whales, grey whales, orcas, dolphins, sharks, marlins, and manta rays.  In addition, it is a safe haven for five endangered species of sea turtles, leatherback and olive ridleys nest on its beaches.  Cabo Pulmo National Marine Park is a no-take marine reserve – fishing is banned.
                </p>
                {% else %}{% if mpa.name == 'Galapagos Marine Reserve' %}
                <p>
                    The Galápagos Marine Reserve, encompassing 133,000 square kilometers (roughly 40nm), was created on March 18, 1998.  The Reserve was established to protect the marine ecosystems and resources around the Galapagos Islands.  These ecosystems are made up of roughly 3000 (currently known) species of marine plants and animals.  It is estimated that 25 percent of the marine species are endemic to the Galápagos Marine Reserve.   These species include marine mammals like whales, dolphins, and sea lions. The area also provides much needed sustenance to species that spend much of their time on land but forage at sea such as; penguins, cormorants, sea lions, and albatrosses. The Galápagos Marine Reserve became a World Heritage Site in 2001.  It has several management zones including multi and limited use.
                </p>
                {% else %}{% if mpa.name == 'Stellwagen Bank National Marine Sanctuary' %}
                <p>
                    The Gerry E. Studds Stellwagen Bank National Marine Sanctuary, an 842-square-mile (638-square-nautical-mile) marine protected area at the mouth of Massachusetts Bay, was established on November 4, 1992.  The Sanctuary was created to conserve and enhance biodiversity as well as protect the cultural heritage of the area.   The Sanctuary lies entirely within federal waters and is an ecologically important area for groundfish species like cod, haddock and flounder.  Atlantic bluefin tuna, large sharks, and large schools of herring are also found within the Sanctuary’s boundaries. The area is also an important foraging ground for many whale species.  The sanctuary is open to both commercial and recreational fishing but prohibits certain activities like sand and gravel mining, transferring petroleum products, and taking or harming marine mammals, birds and turtles.
                </p>
                {% else %}{% if mpa.summary %}
                    <p>
                        {{ mpa.summary }}
                    </p>
                {% else %}{% if mpa.wikiarticle %}
                    <p>
                        {{ mpa.wikiarticle.title }}
                        <br />
                        from wikipedia: <a href="{{ mpa.wikiarticle.url|safe }}">{{ mpa.wikiarticle.url|safe }}</a>
                    </p>
                        {{ mpa.wikiarticle.summary|safe }}
                {% else %}
        		<p>
        		    ...
        		</p>
                {% endif %}{% endif %}{% endif %}{% endif %}{% endif %}
        	</div>

        	<div class="sidebar_item_title">Nearby Sites</div>
        	<div class="sidebar_item_content">
        	    Showing nearest 5 MPAs (&lt; 500km away)<br />
        	    {% comment %}
                        {% for nearmpa in mpa.getnearbyareas %}
        		    {{ nearmpa.name }}: {{ nearmpa.distance.km }} km<br />
        		{% endfor %}
                    {% endcomment %}
        	</div>
        	
        	<div class="sidebar_item_title">Contacts &amp; Resources</div>
        	<div class="sidebar_item_content">
        	    
        	</div>
    	</div>
    </div>
    <div class="clear"></div>

    {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}
{% endblock %}
